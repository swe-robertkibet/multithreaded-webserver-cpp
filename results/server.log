ThreadPool initialized with 16 threads
LRU Cache initialized: 100MB max, 300s TTL
Starting high-performance HTTP server on port 8080...
Server started successfully with epoll + thread pool.
Press Ctrl+C to stop.
=================================================================
==132455==ERROR: AddressSanitizer: heap-use-after-free on address 0x503000a74310 at pc 0x64050df6914b bp 0x749ba16fc450 sp 0x749ba16fc440
READ of size 8 at 0x503000a74310 thread T2
    #0 0x64050df6914a in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_erase(std::integral_constant<bool, true>, int const&) /usr/include/c++/11/bits/hashtable.h:2208
    #1 0x64050df5bec1 in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::erase(int const&) /usr/include/c++/11/bits/hashtable.h:938
    #2 0x64050df5bec1 in std::unordered_map<int, void*, std::hash<int>, std::equal_to<int>, std::allocator<std::pair<int const, void*> > >::erase(int const&) /usr/include/c++/11/bits/unordered_map.h:763
    #3 0x64050df5bec1 in EpollWrapper::remove_fd(int) /home/robert/multithreaded-webserver-cpp/src/epoll_wrapper.cpp:73
    #4 0x64050e03975a in Server::close_connection(int) /home/robert/multithreaded-webserver-cpp/src/server.cpp:408
    #5 0x64050e04388c in Server::handle_client_request(std::shared_ptr<Connection>) /home/robert/multithreaded-webserver-cpp/src/server.cpp:384
    #6 0x64050e07f363 in void std::__invoke_impl<void, void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&>(std::__invoke_memfun_deref, void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&) /usr/include/c++/11/bits/invoke.h:74
    #7 0x64050e07f363 in std::__invoke_result<void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&>::type std::__invoke<void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&>(void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&) /usr/include/c++/11/bits/invoke.h:96
    #8 0x64050e07f363 in void std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>::__call<void, , 0ul, 1ul>(std::tuple<>&&, std::_Index_tuple<0ul, 1ul>) /usr/include/c++/11/functional:420
    #9 0x64050e07f363 in void std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>::operator()<, void>() /usr/include/c++/11/functional:503
    #10 0x64050e07f363 in void std::__invoke_impl<void, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&>(std::__invoke_other, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&) /usr/include/c++/11/bits/invoke.h:61
    #11 0x64050e07f363 in std::enable_if<is_invocable_r_v<void, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&>, void>::type std::__invoke_r<void, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&>(std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&) /usr/include/c++/11/bits/invoke.h:111
    #12 0x64050e07f363 in std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const /usr/include/c++/11/future:1468
    #13 0x64050e07f363 in std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const /usr/include/c++/11/future:1409
    #14 0x64050e08059a in std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) /usr/include/c++/11/bits/invoke.h:61
    #15 0x64050e08059a in std::enable_if<is_invocable_r_v<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>, std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> >::type std::__invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) /usr/include/c++/11/bits/invoke.h:116
    #16 0x64050e08059a in std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void> >::_M_invoke(std::_Any_data const&) /usr/include/c++/11/bits/std_function.h:291
    #17 0x64050e05e81f in std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/11/bits/std_function.h:590
    #18 0x64050e05e81f in std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/11/future:571
    #19 0x64050e06b7c2 in void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/11/bits/invoke.h:74
    #20 0x64050e06b7c2 in std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/11/bits/invoke.h:96
    #21 0x64050e06b7c2 in std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/11/mutex:776
    #22 0x64050e06b7c2 in std::once_flag::_Prepare_execution::_Prepare_execution<std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}>(void (std::__future_base::_State_baseV2::*&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*))::{lambda()#1}::operator()() const /usr/include/c++/11/mutex:712
    #23 0x64050e06b89b in std::once_flag::_Prepare_execution::_Prepare_execution<std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}>(void (std::__future_base::_State_baseV2::*&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*))::{lambda()#1}::_FUN() /usr/include/c++/11/mutex:712
    #24 0x749ba5499ee7  (/lib/x86_64-linux-gnu/libc.so.6+0x99ee7)
    #25 0x64050e06811a in __gthread_once /usr/include/x86_64-linux-gnu/c++/11/bits/gthr-default.h:700
    #26 0x64050e06811a in void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/11/mutex:783
    #27 0x64050e0686e0 in std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/11/future:411
    #28 0x64050e0686e0 in std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run() /usr/include/c++/11/future:1471
    #29 0x64050e05c8ca in std::packaged_task<void ()>::operator()() /usr/include/c++/11/future:1604
    #30 0x64050e05c8ca in ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}::operator()() const /home/robert/multithreaded-webserver-cpp/include/thread_pool.h:54
    #31 0x64050e05c8ca in void std::__invoke_impl<void, ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}&>(std::__invoke_other, ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}&) /usr/include/c++/11/bits/invoke.h:61
    #32 0x64050e05c8ca in std::enable_if<is_invocable_r_v<void, ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}&>, void>::type std::__invoke_r<void, ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}&>(ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}&) /usr/include/c++/11/bits/invoke.h:111
    #33 0x64050e05c8ca in std::_Function_handler<void (), ThreadPool::enqueue<void (Server::*)(std::shared_ptr<Connection>), Server*, std::shared_ptr<Connection>&>(void (Server::*&&)(std::shared_ptr<Connection>), Server*&&, std::shared_ptr<Connection>&)::{lambda()#1}>::_M_invoke(std::_Any_data const&) /usr/include/c++/11/bits/std_function.h:290
    #34 0x64050e083b93 in std::function<void ()>::operator()() const /usr/include/c++/11/bits/std_function.h:590
    #35 0x64050e083b93 in ThreadPool::worker_thread() /home/robert/multithreaded-webserver-cpp/src/thread_pool.cpp:69
    #36 0x64050e08a511 in void std::__invoke_impl<void, void (ThreadPool::*)(), ThreadPool*>(std::__invoke_memfun_deref, void (ThreadPool::*&&)(), ThreadPool*&&) /usr/include/c++/11/bits/invoke.h:74
    #37 0x64050e08a511 in std::__invoke_result<void (ThreadPool::*)(), ThreadPool*>::type std::__invoke<void (ThreadPool::*)(), ThreadPool*>(void (ThreadPool::*&&)(), ThreadPool*&&) /usr/include/c++/11/bits/invoke.h:96
    #38 0x64050e08a511 in void std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/11/bits/std_thread.h:259
    #39 0x64050e08a511 in std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> >::operator()() /usr/include/c++/11/bits/std_thread.h:266
    #40 0x64050e08a511 in std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (ThreadPool::*)(), ThreadPool*> > >::_M_run() /usr/include/c++/11/bits/std_thread.h:211
    #41 0x749ba60dc252  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc252)
    #42 0x749ba5494ac2  (/lib/x86_64-linux-gnu/libc.so.6+0x94ac2)
    #43 0x749ba552684f  (/lib/x86_64-linux-gnu/libc.so.6+0x12684f)

0x503000a74310 is located 0 bytes inside of 24-byte region [0x503000a74310,0x503000a74328)
freed by thread T8 here:
    #0 0x749ba64b724f in operator delete(void*, unsigned long) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:172
    #1 0x64050df689d3 in __gnu_cxx::new_allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> >::deallocate(std::__detail::_Hash_node<std::pair<int const, void*>, false>*, unsigned long) /usr/include/c++/11/ext/new_allocator.h:145
    #2 0x64050df689d3 in std::allocator_traits<std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> > >::deallocate(std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> >&, std::__detail::_Hash_node<std::pair<int const, void*>, false>*, unsigned long) /usr/include/c++/11/bits/alloc_traits.h:496
    #3 0x64050df689d3 in std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> > >::_M_deallocate_node_ptr(std::__detail::_Hash_node<std::pair<int const, void*>, false>*) /usr/include/c++/11/bits/hashtable_policy.h:1905
    #4 0x64050df689d3 in std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> > >::_M_deallocate_node(std::__detail::_Hash_node<std::pair<int const, void*>, false>*) /usr/include/c++/11/bits/hashtable_policy.h:1895
    #5 0x64050df689d3 in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_erase(unsigned long, std::__detail::_Hash_node_base*, std::__detail::_Hash_node<std::pair<int const, void*>, false>*) /usr/include/c++/11/bits/hashtable.h:2183
    #6 0x64050df68fb0 in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_erase(std::integral_constant<bool, true>, int const&) /usr/include/c++/11/bits/hashtable.h:2209
    #7 0x64050df5bec1 in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::erase(int const&) /usr/include/c++/11/bits/hashtable.h:938
    #8 0x64050df5bec1 in std::unordered_map<int, void*, std::hash<int>, std::equal_to<int>, std::allocator<std::pair<int const, void*> > >::erase(int const&) /usr/include/c++/11/bits/unordered_map.h:763
    #9 0x64050df5bec1 in EpollWrapper::remove_fd(int) /home/robert/multithreaded-webserver-cpp/src/epoll_wrapper.cpp:73
    #10 0x64050e03975a in Server::close_connection(int) /home/robert/multithreaded-webserver-cpp/src/server.cpp:408
    #11 0x64050e04388c in Server::handle_client_request(std::shared_ptr<Connection>) /home/robert/multithreaded-webserver-cpp/src/server.cpp:384
    #12 0x64050e07f363 in void std::__invoke_impl<void, void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&>(std::__invoke_memfun_deref, void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&) /usr/include/c++/11/bits/invoke.h:74
    #13 0x64050e07f363 in std::__invoke_result<void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&>::type std::__invoke<void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&>(void (Server::*&)(std::shared_ptr<Connection>), Server*&, std::shared_ptr<Connection>&) /usr/include/c++/11/bits/invoke.h:96
    #14 0x64050e07f363 in void std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>::__call<void, , 0ul, 1ul>(std::tuple<>&&, std::_Index_tuple<0ul, 1ul>) /usr/include/c++/11/functional:420
    #15 0x64050e07f363 in void std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>::operator()<, void>() /usr/include/c++/11/functional:503
    #16 0x64050e07f363 in void std::__invoke_impl<void, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&>(std::__invoke_other, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&) /usr/include/c++/11/bits/invoke.h:61
    #17 0x64050e07f363 in std::enable_if<is_invocable_r_v<void, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&>, void>::type std::__invoke_r<void, std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&>(std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>&) /usr/include/c++/11/bits/invoke.h:111
    #18 0x64050e07f363 in std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}::operator()() const /usr/include/c++/11/future:1468
    #19 0x64050e07f363 in std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>::operator()() const /usr/include/c++/11/future:1409
    #20 0x64050e08059a in std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter> std::__invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__invoke_other, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) /usr/include/c++/11/bits/invoke.h:61
    #21 0x64050e08059a in std::enable_if<is_invocable_r_v<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>, std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> >::type std::__invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&>(std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void>&) /usr/include/c++/11/bits/invoke.h:116
    #22 0x64050e08059a in std::_Function_handler<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> (), std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<std::_Bind<void (Server::*(Server*, std::shared_ptr<Connection>))(std::shared_ptr<Connection>)>, std::allocator<int>, void ()>::_M_run()::{lambda()#1}, void> >::_M_invoke(std::_Any_data const&) /usr/include/c++/11/bits/std_function.h:291
    #23 0x64050e05e81f in std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/11/bits/std_function.h:590
    #24 0x64050e05e81f in std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/11/future:571
    #25 0x64050e06b7c2 in void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/11/bits/invoke.h:74
    #26 0x64050e06b7c2 in std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/11/bits/invoke.h:96
    #27 0x64050e06b7c2 in std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/11/mutex:776
    #28 0x64050e06b7c2 in std::once_flag::_Prepare_execution::_Prepare_execution<std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}>(void (std::__future_base::_State_baseV2::*&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*))::{lambda()#1}::operator()() const /usr/include/c++/11/mutex:712
    #29 0x64050e06b89b in std::once_flag::_Prepare_execution::_Prepare_execution<std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}>(void (std::__future_base::_State_baseV2::*&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*))::{lambda()#1}::_FUN() /usr/include/c++/11/mutex:712
    #30 0x749ba5499ee7  (/lib/x86_64-linux-gnu/libc.so.6+0x99ee7)

previously allocated by thread T17 here:
    #0 0x749ba64b61e7 in operator new(unsigned long) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:99
    #1 0x64050df6b9b9 in __gnu_cxx::new_allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> >::allocate(unsigned long, void const*) /usr/include/c++/11/ext/new_allocator.h:127
    #2 0x64050df6b9b9 in std::allocator_traits<std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> > >::allocate(std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> >&, unsigned long) /usr/include/c++/11/bits/alloc_traits.h:464
    #3 0x64050df6b9b9 in std::__detail::_Hash_node<std::pair<int const, void*>, false>* std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> > >::_M_allocate_node<std::piecewise_construct_t const&, std::tuple<int const&>, std::tuple<> >(std::piecewise_construct_t const&, std::tuple<int const&>&&, std::tuple<>&&) /usr/include/c++/11/bits/hashtable_policy.h:1873
    #4 0x64050df6b9b9 in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_Scoped_node::_Scoped_node<std::piecewise_construct_t const&, std::tuple<int const&>, std::tuple<> >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<int const, void*>, false> > >*, std::piecewise_construct_t const&, std::tuple<int const&>&&, std::tuple<>&&) /usr/include/c++/11/bits/hashtable.h:304
    #5 0x64050df6b9b9 in std::__detail::_Map_base<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true>, true>::operator[](int const&) /usr/include/c++/11/bits/hashtable_policy.h:707
    #6 0x64050df612ec in std::unordered_map<int, void*, std::hash<int>, std::equal_to<int>, std::allocator<std::pair<int const, void*> > >::operator[](int const&) /usr/include/c++/11/bits/unordered_map.h:980
    #7 0x64050df612ec in EpollWrapper::wait_for_events(std::vector<EpollWrapper::Event, std::allocator<EpollWrapper::Event> >&, int) /home/robert/multithreaded-webserver-cpp/src/epoll_wrapper.cpp:94
    #8 0x64050e051808 in Server::event_loop() /home/robert/multithreaded-webserver-cpp/src/server.cpp:130
    #9 0x64050e05bb75 in void std::__invoke_impl<void, void (Server::*)(), Server*>(std::__invoke_memfun_deref, void (Server::*&&)(), Server*&&) /usr/include/c++/11/bits/invoke.h:74
    #10 0x64050e05bb75 in std::__invoke_result<void (Server::*)(), Server*>::type std::__invoke<void (Server::*)(), Server*>(void (Server::*&&)(), Server*&&) /usr/include/c++/11/bits/invoke.h:96
    #11 0x64050e05bb75 in void std::thread::_Invoker<std::tuple<void (Server::*)(), Server*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/11/bits/std_thread.h:259
    #12 0x64050e05bb75 in std::thread::_Invoker<std::tuple<void (Server::*)(), Server*> >::operator()() /usr/include/c++/11/bits/std_thread.h:266
    #13 0x64050e05bb75 in std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (Server::*)(), Server*> > >::_M_run() /usr/include/c++/11/bits/std_thread.h:211
    #14 0x749ba60dc252  (/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc252)

Thread T2 created by T0 here:
    #0 0x749ba6458685 in __interceptor_pthread_create ../../../../src/libsanitizer/asan/asan_interceptors.cpp:216
    #1 0x749ba60dc328 in std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc328)
    #2 0x64050e0887b1 in ThreadPool::ThreadPool(unsigned long) /home/robert/multithreaded-webserver-cpp/src/thread_pool.cpp:15
    #3 0x64050e056a95 in std::_MakeUniq<ThreadPool>::__single_object std::make_unique<ThreadPool, unsigned long&>(unsigned long&) /usr/include/c++/11/bits/unique_ptr.h:962
    #4 0x64050e056a95 in Server::Server(int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, unsigned long) /home/robert/multithreaded-webserver-cpp/src/server.cpp:21
    #5 0x64050e01817f in std::_MakeUniq<Server>::__single_object std::make_unique<Server, int&, char const (&) [8], unsigned long&>(int&, char const (&) [8], unsigned long&) /usr/include/c++/11/bits/unique_ptr.h:962
    #6 0x64050e01817f in main /home/robert/multithreaded-webserver-cpp/src/main.cpp:51
    #7 0x749ba5429d8f  (/lib/x86_64-linux-gnu/libc.so.6+0x29d8f)

Thread T8 created by T0 here:
    #0 0x749ba6458685 in __interceptor_pthread_create ../../../../src/libsanitizer/asan/asan_interceptors.cpp:216
    #1 0x749ba60dc328 in std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc328)
    #2 0x64050e0887b1 in ThreadPool::ThreadPool(unsigned long) /home/robert/multithreaded-webserver-cpp/src/thread_pool.cpp:15
    #3 0x64050e056a95 in std::_MakeUniq<ThreadPool>::__single_object std::make_unique<ThreadPool, unsigned long&>(unsigned long&) /usr/include/c++/11/bits/unique_ptr.h:962
    #4 0x64050e056a95 in Server::Server(int, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, unsigned long) /home/robert/multithreaded-webserver-cpp/src/server.cpp:21
    #5 0x64050e01817f in std::_MakeUniq<Server>::__single_object std::make_unique<Server, int&, char const (&) [8], unsigned long&>(int&, char const (&) [8], unsigned long&) /usr/include/c++/11/bits/unique_ptr.h:962
    #6 0x64050e01817f in main /home/robert/multithreaded-webserver-cpp/src/main.cpp:51
    #7 0x749ba5429d8f  (/lib/x86_64-linux-gnu/libc.so.6+0x29d8f)

Thread T17 created by T0 here:
    #0 0x749ba6458685 in __interceptor_pthread_create ../../../../src/libsanitizer/asan/asan_interceptors.cpp:216
    #1 0x749ba60dc328 in std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) (/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc328)
    #2 0x64050e0185a0 in main /home/robert/multithreaded-webserver-cpp/src/main.cpp:59
    #3 0x749ba5429d8f  (/lib/x86_64-linux-gnu/libc.so.6+0x29d8f)

SUMMARY: AddressSanitizer: heap-use-after-free /usr/include/c++/11/bits/hashtable.h:2208 in std::_Hashtable<int, std::pair<int const, void*>, std::allocator<std::pair<int const, void*> >, std::__detail::_Select1st, std::equal_to<int>, std::hash<int>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_erase(std::integral_constant<bool, true>, int const&)
Shadow bytes around the buggy address:
  0x0a0680146810: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa
  0x0a0680146820: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd
  0x0a0680146830: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd
  0x0a0680146840: fd fd fa fa fd fd fd fd fa fa fd fd fd fa fa fa
  0x0a0680146850: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fa
=>0x0a0680146860: fa fa[fd]fd fd fa fa fa fd fd fd fd fa fa fd fd
  0x0a0680146870: fd fd fa fa fd fd fd fd fa fa fd fd fd fd fa fa
  0x0a0680146880: fd fd fd fa fa fa fd fd fd fd fa fa fd fd fd fa
  0x0a0680146890: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd
  0x0a06801468a0: fd fd fa fa fd fd fd fd fa fa fa fa fa fa fa fa
  0x0a06801468b0: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==132455==ABORTING
